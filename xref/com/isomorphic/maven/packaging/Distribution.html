<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Distribution xref</title>
<link type="text/css" rel="stylesheet" href="../../../../stylesheet.css" />
</head>
<body>
<div id="overview"><a href="../../../../../apidocs/com/isomorphic/maven/packaging/Distribution.html">View Javadoc</a></div><pre>

<a class="jxr_linenumber" name="1" href="#1">1</a>   <strong class="jxr_keyword">package</strong> com.isomorphic.maven.packaging;
<a class="jxr_linenumber" name="2" href="#2">2</a>   
<a class="jxr_linenumber" name="3" href="#3">3</a>   <em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="4" href="#4">4</a>   <em class="jxr_comment"> * Licensed to the Apache Software Foundation (ASF) under one</em>
<a class="jxr_linenumber" name="5" href="#5">5</a>   <em class="jxr_comment"> * or more contributor license agreements.  See the NOTICE file</em>
<a class="jxr_linenumber" name="6" href="#6">6</a>   <em class="jxr_comment"> * distributed with this work for additional information</em>
<a class="jxr_linenumber" name="7" href="#7">7</a>   <em class="jxr_comment"> * regarding copyright ownership.  The ASF licenses this file</em>
<a class="jxr_linenumber" name="8" href="#8">8</a>   <em class="jxr_comment"> * to you under the Apache License, Version 2.0 (the</em>
<a class="jxr_linenumber" name="9" href="#9">9</a>   <em class="jxr_comment"> * "License"); you may not use this file except in compliance</em>
<a class="jxr_linenumber" name="10" href="#10">10</a>  <em class="jxr_comment"> * with the License.  You may obtain a copy of the License at</em>
<a class="jxr_linenumber" name="11" href="#11">11</a>  <em class="jxr_comment"> *</em>
<a class="jxr_linenumber" name="12" href="#12">12</a>  <em class="jxr_comment"> *  <a href="http://www.apache.org/licenses/LICENSE-2.0" target="alexandria_uri">http://www.apache.org/licenses/LICENSE-2.0</a></em>
<a class="jxr_linenumber" name="13" href="#13">13</a>  <em class="jxr_comment"> *</em>
<a class="jxr_linenumber" name="14" href="#14">14</a>  <em class="jxr_comment"> * Unless required by applicable law or agreed to in writing,</em>
<a class="jxr_linenumber" name="15" href="#15">15</a>  <em class="jxr_comment"> * software distributed under the License is distributed on an</em>
<a class="jxr_linenumber" name="16" href="#16">16</a>  <em class="jxr_comment"> * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</em>
<a class="jxr_linenumber" name="17" href="#17">17</a>  <em class="jxr_comment"> * KIND, either express or implied.  See the License for the</em>
<a class="jxr_linenumber" name="18" href="#18">18</a>  <em class="jxr_comment"> * specific language governing permissions and limitations</em>
<a class="jxr_linenumber" name="19" href="#19">19</a>  <em class="jxr_comment"> * under the License.</em>
<a class="jxr_linenumber" name="20" href="#20">20</a>  <em class="jxr_comment"> */</em>
<a class="jxr_linenumber" name="21" href="#21">21</a>  
<a class="jxr_linenumber" name="22" href="#22">22</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.ANALYTICS_MODULE;
<a class="jxr_linenumber" name="23" href="#23">23</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.ENTERPRISE;
<a class="jxr_linenumber" name="24" href="#24">24</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.EVAL;
<a class="jxr_linenumber" name="25" href="#25">25</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.LGPL;
<a class="jxr_linenumber" name="26" href="#26">26</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.MESSAGING_MODULE;
<a class="jxr_linenumber" name="27" href="#27">27</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.POWER;
<a class="jxr_linenumber" name="28" href="#28">28</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.License.PRO;
<a class="jxr_linenumber" name="29" href="#29">29</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.Product.SMARTCLIENT;
<a class="jxr_linenumber" name="30" href="#30">30</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.Product.SMARTGWT;
<a class="jxr_linenumber" name="31" href="#31">31</a>  <strong class="jxr_keyword">import</strong> <strong class="jxr_keyword">static</strong> com.isomorphic.maven.packaging.Product.SMARTGWT_MOBILE;
<a class="jxr_linenumber" name="32" href="#32">32</a>  
<a class="jxr_linenumber" name="33" href="#33">33</a>  <strong class="jxr_keyword">import</strong> java.io.File;
<a class="jxr_linenumber" name="34" href="#34">34</a>  <strong class="jxr_keyword">import</strong> java.io.FileFilter;
<a class="jxr_linenumber" name="35" href="#35">35</a>  <strong class="jxr_keyword">import</strong> java.io.IOException;
<a class="jxr_linenumber" name="36" href="#36">36</a>  <strong class="jxr_keyword">import</strong> java.util.ArrayList;
<a class="jxr_linenumber" name="37" href="#37">37</a>  <strong class="jxr_keyword">import</strong> java.util.Collection;
<a class="jxr_linenumber" name="38" href="#38">38</a>  <strong class="jxr_keyword">import</strong> java.util.Enumeration;
<a class="jxr_linenumber" name="39" href="#39">39</a>  <strong class="jxr_keyword">import</strong> java.util.HashMap;
<a class="jxr_linenumber" name="40" href="#40">40</a>  <strong class="jxr_keyword">import</strong> java.util.HashSet;
<a class="jxr_linenumber" name="41" href="#41">41</a>  <strong class="jxr_keyword">import</strong> java.util.List;
<a class="jxr_linenumber" name="42" href="#42">42</a>  <strong class="jxr_keyword">import</strong> java.util.Map;
<a class="jxr_linenumber" name="43" href="#43">43</a>  <strong class="jxr_keyword">import</strong> java.util.Set;
<a class="jxr_linenumber" name="44" href="#44">44</a>  <strong class="jxr_keyword">import</strong> java.util.zip.ZipEntry;
<a class="jxr_linenumber" name="45" href="#45">45</a>  <strong class="jxr_keyword">import</strong> java.util.zip.ZipFile;
<a class="jxr_linenumber" name="46" href="#46">46</a>  
<a class="jxr_linenumber" name="47" href="#47">47</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.io.FileUtils;
<a class="jxr_linenumber" name="48" href="#48">48</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.io.FilenameUtils;
<a class="jxr_linenumber" name="49" href="#49">49</a>  <strong class="jxr_keyword">import</strong> org.apache.commons.lang3.StringUtils;
<a class="jxr_linenumber" name="50" href="#50">50</a>  <strong class="jxr_keyword">import</strong> org.slf4j.Logger;
<a class="jxr_linenumber" name="51" href="#51">51</a>  <strong class="jxr_keyword">import</strong> org.slf4j.LoggerFactory;
<a class="jxr_linenumber" name="52" href="#52">52</a>  <strong class="jxr_keyword">import</strong> org.springframework.util.CollectionUtils;
<a class="jxr_linenumber" name="53" href="#53">53</a>  
<a class="jxr_linenumber" name="54" href="#54">54</a>  <strong class="jxr_keyword">import</strong> com.google.common.base.Joiner;
<a class="jxr_linenumber" name="55" href="#55">55</a>  <strong class="jxr_keyword">import</strong> com.google.common.collect.HashBasedTable;
<a class="jxr_linenumber" name="56" href="#56">56</a>  <strong class="jxr_keyword">import</strong> com.google.common.collect.Table;
<a class="jxr_linenumber" name="57" href="#57">57</a>  <strong class="jxr_keyword">import</strong> com.isomorphic.maven.util.AntPathMatcherFilter;
<a class="jxr_linenumber" name="58" href="#58">58</a>  <strong class="jxr_keyword">import</strong> com.isomorphic.maven.util.ArchiveUtils;
<a class="jxr_linenumber" name="59" href="#59">59</a>  
<a class="jxr_linenumber" name="60" href="#60">60</a>  <em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="61" href="#61">61</a>  <em class="jxr_javadoccomment"> * Models both the location/filenames of remote SDK bundles and their contents.  Takes care to normalize product families into </em>
<a class="jxr_linenumber" name="62" href="#62">62</a>  <em class="jxr_javadoccomment"> * some common denominator</em>
<a class="jxr_linenumber" name="63" href="#63">63</a>  <em class="jxr_javadoccomment"> */</em>
<a class="jxr_linenumber" name="64" href="#64">64</a>  <strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">final</strong> <strong class="jxr_keyword">class</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> {
<a class="jxr_linenumber" name="65" href="#65">65</a>  
<a class="jxr_linenumber" name="66" href="#66">66</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> Logger LOGGER = LoggerFactory.getLogger(Distribution.<strong class="jxr_keyword">class</strong>);
<a class="jxr_linenumber" name="67" href="#67">67</a>  
<a class="jxr_linenumber" name="68" href="#68">68</a>  	<em class="jxr_comment">//a default regex pattern used to find the files available for download</em>
<a class="jxr_linenumber" name="69" href="#69">69</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String LINK_SELECTOR = <span class="jxr_string">"(?i)&#92;&#92;.(zip|jar)"</span>;
<a class="jxr_linenumber" name="70" href="#70">70</a>  	
<a class="jxr_linenumber" name="71" href="#71">71</a>  	<em class="jxr_comment">//ant-style wildcards used at extraction for filtering the distribution for non-javadoc documentation resources</em>
<a class="jxr_linenumber" name="72" href="#72">72</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String DOC_INCLUDES = <span class="jxr_string">"**/*.pdf"</span>;
<a class="jxr_linenumber" name="73" href="#73">73</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String DOC_EXCLUDES = <span class="jxr_string">"**/apache-ant*/**"</span>;
<a class="jxr_linenumber" name="74" href="#74">74</a>  	
<a class="jxr_linenumber" name="75" href="#75">75</a>  	<em class="jxr_comment">//ant-style wildcards used at extraction for filtering the distribution for the JARs to be included </em>
<a class="jxr_linenumber" name="76" href="#76">76</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String JAR_INCLUDES = <span class="jxr_string">"**/isc-*.jar, **/isomorphic_*.jar, **/smartgwt-*.jar"</span>;
<a class="jxr_linenumber" name="77" href="#77">77</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String JAR_EXCLUDES = <span class="jxr_string">"**/samples/**, **/*examples.jar, **/*tomcat.jar, **/*isomorphic_web_services.jar, **/isomorphic_applets.jar"</span>;
<a class="jxr_linenumber" name="78" href="#78">78</a>  	
<a class="jxr_linenumber" name="79" href="#79">79</a>  	<em class="jxr_comment">//the following ant patterns currently yield files that are deliberately renamed (see static initialization block) - exclude them as well</em>
<a class="jxr_linenumber" name="80" href="#80">80</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String JAR_CONFLICTS = <span class="jxr_string">"**/smartgwtee.jar, **/isc-jakarta-oro*.jar, **/isomorphic_realtime_messaging.jar"</span>;		
<a class="jxr_linenumber" name="81" href="#81">81</a>  	
<a class="jxr_linenumber" name="82" href="#82">82</a>  	<em class="jxr_comment">//ant-style wildcards used at extraction for filtering the distribution for the POMs to be included</em>
<a class="jxr_linenumber" name="83" href="#83">83</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String POM_SMARTCLIENT = <span class="jxr_string">"**/smartclient-*resources.pom, **/smartclient-tools.xml, **/smartclient-messaging.xml, **/smartclient-analytics.xml"</span>;
<a class="jxr_linenumber" name="84" href="#84">84</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String POM_SMARTGWT = <span class="jxr_string">"**/smartgwt-skins.pom, **/smartgwt-analytics.pom, **/smartgwt-messaging.pom"</span>;
<a class="jxr_linenumber" name="85" href="#85">85</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String POM_SERVER = <span class="jxr_string">"**/isomorphic-*.pom, **/isomorphic-*.xml, **/dependencygroup-*.xml"</span>;
<a class="jxr_linenumber" name="86" href="#86">86</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String POM_SHARED = <span class="jxr_string">"**/isc-*.pom, **/isc-*.xml"</span>;
<a class="jxr_linenumber" name="87" href="#87">87</a>  
<a class="jxr_linenumber" name="88" href="#88">88</a>  	<em class="jxr_comment">//ant-style wildcards used at extraction for filtering the distribution for Selenium support resources</em>
<a class="jxr_linenumber" name="89" href="#89">89</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SELENIUM_INCLUDES = <span class="jxr_string">"**/selenium/**, **/batchReport.template"</span>;
<a class="jxr_linenumber" name="90" href="#90">90</a>  
<a class="jxr_linenumber" name="91" href="#91">91</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTCLIENT_RUNTIME_INCLUDES = <span class="jxr_string">"**/smartclientRuntime/isomorphic/**, **/smartclientRuntime/WEB-INF/classes/**, **/smartclientRuntime/WEB-INF/iscTaglib.xml"</span>;
<a class="jxr_linenumber" name="92" href="#92">92</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTCLIENT_SDK_INCLUDES = <span class="jxr_string">"**/smartclientSDK/tools/**"</span>;
<a class="jxr_linenumber" name="93" href="#93">93</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTCLIENT_SDK_EXCLUDES = <span class="jxr_string">"**/dsBrowser.jsp,**/classBrowser.jsp,**/sqlBrowser.jsp,**/maven/**"</span>;
<a class="jxr_linenumber" name="94" href="#94">94</a>  	
<a class="jxr_linenumber" name="95" href="#95">95</a>  	<em class="jxr_comment">//ant-style wildcards used at extraction for filtering the distribution for javadoc documentation resources</em>
<a class="jxr_linenumber" name="96" href="#96">96</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTCLIENT_JAVADOC = <span class="jxr_string">"**/smartclientSDK/isomorphic/system/reference/server/javadoc/**"</span>;
<a class="jxr_linenumber" name="97" href="#97">97</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTGWT_CLIENT_JAVADOC = <span class="jxr_string">"**/doc/javadoc/**"</span>;
<a class="jxr_linenumber" name="98" href="#98">98</a>  	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> String SMARTGWT_SERVER_JAVADOC = <span class="jxr_string">"**/doc/server/javadoc/**"</span>;
<a class="jxr_linenumber" name="99" href="#99">99</a>  
<a class="jxr_linenumber" name="100" href="#100">100</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <strong class="jxr_keyword">final</strong> Table&lt;Product, License, Distribution&gt; DISTRIBUTIONS = HashBasedTable.create();
<a class="jxr_linenumber" name="101" href="#101">101</a> 	
<a class="jxr_linenumber" name="102" href="#102">102</a> 	<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="103" href="#103">103</a> <em class="jxr_comment">	 * Configure every possible Product/License combination and store the result in a table for lookup on demand.</em>
<a class="jxr_linenumber" name="104" href="#104">104</a> <em class="jxr_comment">	 * Note that smartgwt JARs are effectively renamed to take the form smartgwt-${license} to provide clarity </em>
<a class="jxr_linenumber" name="105" href="#105">105</a> <em class="jxr_comment">	 * and to better facilitate POM matching.  </em>
<a class="jxr_linenumber" name="106" href="#106">106</a> <em class="jxr_comment">	 */</em>
<a class="jxr_linenumber" name="107" href="#107">107</a> 	<strong class="jxr_keyword">static</strong> {	
<a class="jxr_linenumber" name="108" href="#108">108</a> 		create(SMARTCLIENT, LGPL);
<a class="jxr_linenumber" name="109" href="#109">109</a> 		create(SMARTCLIENT, EVAL);
<a class="jxr_linenumber" name="110" href="#110">110</a> 		create(SMARTCLIENT, PRO);
<a class="jxr_linenumber" name="111" href="#111">111</a> 		create(SMARTCLIENT, POWER);
<a class="jxr_linenumber" name="112" href="#112">112</a> 		create(SMARTCLIENT, ENTERPRISE);
<a class="jxr_linenumber" name="113" href="#113">113</a> 		create(SMARTCLIENT, ANALYTICS_MODULE);
<a class="jxr_linenumber" name="114" href="#114">114</a> 		create(SMARTCLIENT, MESSAGING_MODULE);
<a class="jxr_linenumber" name="115" href="#115">115</a> 
<a class="jxr_linenumber" name="116" href="#116">116</a> 		<em class="jxr_comment">//the smartgwt lgpl edition provides links to a bunch of resources that are also contained in the .zip - ignore them</em>
<a class="jxr_linenumber" name="117" href="#117">117</a> 		create(SMARTGWT, LGPL)
<a class="jxr_linenumber" name="118" href="#118">118</a> 			.include(<span class="jxr_string">"smartgwt-.*&#92;&#92;.zip"</span>)
<a class="jxr_linenumber" name="119" href="#119">119</a> 			.contents(<span class="jxr_string">"lib/smartgwt-lgpl.jar"</span>, <span class="jxr_string">"**/smartgwt.jar"</span> , <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="120" href="#120">120</a> 		
<a class="jxr_linenumber" name="121" href="#121">121</a> 		<em class="jxr_comment">//the smartgwt eval URL takes a different form than the smartclient eval URL, for some reason</em>
<a class="jxr_linenumber" name="122" href="#122">122</a> 		create(SMARTGWT, EVAL)
<a class="jxr_linenumber" name="123" href="#123">123</a> 			.index(<span class="jxr_string">"#license"</span>, <span class="jxr_string">"EnterpriseEval"</span>)
<a class="jxr_linenumber" name="124" href="#124">124</a> 			.contents(<span class="jxr_string">"lib/smartgwt-eval.jar"</span>, <span class="jxr_string">"**/smartgwtee.jar"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="125" href="#125">125</a> 		
<a class="jxr_linenumber" name="126" href="#126">126</a> 		create(SMARTGWT, PRO)
<a class="jxr_linenumber" name="127" href="#127">127</a> 			.contents(<span class="jxr_string">"lib/smartgwt-pro.jar"</span>, <span class="jxr_string">"**/smartgwtpro.jar"</span>, <strong class="jxr_keyword">null</strong>);;
<a class="jxr_linenumber" name="128" href="#128">128</a> 		
<a class="jxr_linenumber" name="129" href="#129">129</a> 		create(SMARTGWT, POWER)
<a class="jxr_linenumber" name="130" href="#130">130</a> 			.contents(<span class="jxr_string">"lib/smartgwt-power.jar"</span>, <span class="jxr_string">"**/smartgwtpower.jar"</span>, <strong class="jxr_keyword">null</strong>);;
<a class="jxr_linenumber" name="131" href="#131">131</a> 		
<a class="jxr_linenumber" name="132" href="#132">132</a> 		create(SMARTGWT, ENTERPRISE)
<a class="jxr_linenumber" name="133" href="#133">133</a> 			.contents(<span class="jxr_string">"lib/smartgwt-enterprise.jar"</span>, <span class="jxr_string">"**/smartgwtee.jar"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="134" href="#134">134</a> 
<a class="jxr_linenumber" name="135" href="#135">135</a> 		create(SMARTGWT, ANALYTICS_MODULE);
<a class="jxr_linenumber" name="136" href="#136">136</a> 		create(SMARTGWT, MESSAGING_MODULE);
<a class="jxr_linenumber" name="137" href="#137">137</a> 		
<a class="jxr_linenumber" name="138" href="#138">138</a> 		<em class="jxr_comment">//mobile user documentation is not currently in pdf format, so the default pattern does not match  </em>
<a class="jxr_linenumber" name="139" href="#139">139</a> 		create(SMARTGWT_MOBILE, LGPL)
<a class="jxr_linenumber" name="140" href="#140">140</a> 			.include(<span class="jxr_string">"smartgwt-.*&#92;&#92;.zip"</span>)
<a class="jxr_linenumber" name="141" href="#141">141</a> 			.contents(<span class="jxr_string">"doc/user"</span>, <span class="jxr_string">"smartgwt-mobile*/user_guide.*"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="142" href="#142">142</a> 	}
<a class="jxr_linenumber" name="143" href="#143">143</a> 
<a class="jxr_linenumber" name="144" href="#144">144</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="145" href="#145">145</a> <em class="jxr_javadoccomment">	 * Object creation method whose invocation has the same effect as calling {@link #create(Product, License, String...)}</em>
<a class="jxr_linenumber" name="146" href="#146">146</a> <em class="jxr_javadoccomment">	 * with {@link #LINK_SELECTOR} in the String argument.</em>
<a class="jxr_linenumber" name="147" href="#147">147</a> <em class="jxr_javadoccomment">     *</em>
<a class="jxr_linenumber" name="148" href="#148">148</a> <em class="jxr_javadoccomment">	 * @param product </em>
<a class="jxr_linenumber" name="149" href="#149">149</a> <em class="jxr_javadoccomment">	 * @param license </em>
<a class="jxr_linenumber" name="150" href="#150">150</a> <em class="jxr_javadoccomment">	 * @return A Distribution object having default configuration values applied</em>
<a class="jxr_linenumber" name="151" href="#151">151</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="152" href="#152">152</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> create(<a href="../../../../com/isomorphic/maven/packaging/Product.html">Product</a> product, <a href="../../../../com/isomorphic/maven/packaging/License.html">License</a> license) {
<a class="jxr_linenumber" name="153" href="#153">153</a> 		<strong class="jxr_keyword">return</strong> create(product, license, LINK_SELECTOR);
<a class="jxr_linenumber" name="154" href="#154">154</a> 	}
<a class="jxr_linenumber" name="155" href="#155">155</a> 	
<a class="jxr_linenumber" name="156" href="#156">156</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="157" href="#157">157</a> <em class="jxr_javadoccomment">	 * Object creation method meant to facilitate a 'fluent interface' style of configuration via a handful of private methods.</em>
<a class="jxr_linenumber" name="158" href="#158">158</a> <em class="jxr_javadoccomment">	 * Objects are created with a set of default property values and retruned for further configuration if so deired.  </em>
<a class="jxr_linenumber" name="159" href="#159">159</a> <em class="jxr_javadoccomment">	 * A reference to the return value is also available in the {@link #DISTRIBUTIONS} table under the given product/key combination.</em>
<a class="jxr_linenumber" name="160" href="#160">160</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="161" href="#161">161</a> <em class="jxr_javadoccomment">	 * @param product</em>
<a class="jxr_linenumber" name="162" href="#162">162</a> <em class="jxr_javadoccomment">	 * @param license</em>
<a class="jxr_linenumber" name="163" href="#163">163</a> <em class="jxr_javadoccomment">	 * @param links</em>
<a class="jxr_linenumber" name="164" href="#164">164</a> <em class="jxr_javadoccomment">	 * @return A Distribution object having default configuration values applied </em>
<a class="jxr_linenumber" name="165" href="#165">165</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="166" href="#166">166</a> 	<strong class="jxr_keyword">private</strong> <strong class="jxr_keyword">static</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> create(<a href="../../../../com/isomorphic/maven/packaging/Product.html">Product</a> product, <a href="../../../../com/isomorphic/maven/packaging/License.html">License</a> license, String... links) {
<a class="jxr_linenumber" name="167" href="#167">167</a> 		
<a class="jxr_linenumber" name="168" href="#168">168</a> 		Distribution distribution = <strong class="jxr_keyword">new</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a>(product, license);
<a class="jxr_linenumber" name="169" href="#169">169</a> 	
<a class="jxr_linenumber" name="170" href="#170">170</a> 		distribution.include(links);
<a class="jxr_linenumber" name="171" href="#171">171</a> 
<a class="jxr_linenumber" name="172" href="#172">172</a> 		<em class="jxr_comment">//e.g., smartclient downloads currently include smartgwt poms and vice-versa.  ignore when inapplicable </em>
<a class="jxr_linenumber" name="173" href="#173">173</a> 		List&lt;String&gt; pomIncludes = <strong class="jxr_keyword">new</strong> ArrayList&lt;String&gt;();
<a class="jxr_linenumber" name="174" href="#174">174</a> 		<strong class="jxr_keyword">if</strong> (product == SMARTCLIENT) {
<a class="jxr_linenumber" name="175" href="#175">175</a> 			pomIncludes.add(POM_SMARTCLIENT);
<a class="jxr_linenumber" name="176" href="#176">176</a> 			distribution
<a class="jxr_linenumber" name="177" href="#177">177</a> 				.contents(<span class="jxr_string">"sdk/#smartclientSDK"</span>, <span class="jxr_string">"**/smartclientSDK/**"</span>, SMARTCLIENT_SDK_EXCLUDES)
<a class="jxr_linenumber" name="178" href="#178">178</a> 				<em class="jxr_comment">//exclude optional modules bundled with eval, and instead allow them to be repackaged in assemblies, as they would normally be (leave development copies of RTM in place for the dev console)</em>
<a class="jxr_linenumber" name="179" href="#179">179</a> 				.contents(<span class="jxr_string">"assembly/smartclient-resources/#smartclientRuntime"</span>, SMARTCLIENT_RUNTIME_INCLUDES, <span class="jxr_string">"**/ISC_Analytics*,**/modules*/ISC_RealtimeMessaging*"</span>)
<a class="jxr_linenumber" name="180" href="#180">180</a> 				<em class="jxr_comment">//unfortunately, they're dropped on the root in optional download, modules directory in eval - use more specific source and target patterns to get the right file in the right place</em>
<a class="jxr_linenumber" name="181" href="#181">181</a> 				.contents(<span class="jxr_string">"assembly/smartclient-analytics-resources/isomorphic/system/modules"</span>, <span class="jxr_string">"ISC_Analytics*,**/modules/ISC_Analytics*"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="182" href="#182">182</a> 				.contents(<span class="jxr_string">"assembly/smartclient-analytics-resources/isomorphic/system/modules-debug"</span>, <span class="jxr_string">"**/modules-debug/ISC_Analytics*"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="183" href="#183">183</a> 				.contents(<span class="jxr_string">"assembly/smartclient-messaging-resources/isomorphic/system/modules"</span>, <span class="jxr_string">"ISC_RealtimeMessaging*,**/modules/ISC_RealtimeMessaging*"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="184" href="#184">184</a> 				.contents(<span class="jxr_string">"assembly/smartclient-messaging-resources/isomorphic/system/modules-debug"</span>, <span class="jxr_string">"**/modules-debug/ISC_RealtimeMessaging*"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="185" href="#185">185</a> 				.contents(<span class="jxr_string">"assembly/smartclient-tools-resources/#smartclientSDK"</span>, SMARTCLIENT_SDK_INCLUDES, SMARTCLIENT_SDK_EXCLUDES);
<a class="jxr_linenumber" name="186" href="#186">186</a> 		} <strong class="jxr_keyword">else</strong> <strong class="jxr_keyword">if</strong> (product == SMARTGWT) {
<a class="jxr_linenumber" name="187" href="#187">187</a> 			pomIncludes.add(POM_SMARTGWT);
<a class="jxr_linenumber" name="188" href="#188">188</a> 		}
<a class="jxr_linenumber" name="189" href="#189">189</a> 		pomIncludes.add(<span class="jxr_string">"**/"</span> + product.getName() + <span class="jxr_string">"-"</span> + license.getName() + <span class="jxr_string">"*"</span>);
<a class="jxr_linenumber" name="190" href="#190">190</a> 		pomIncludes.add(POM_SHARED);
<a class="jxr_linenumber" name="191" href="#191">191</a> 		
<a class="jxr_linenumber" name="192" href="#192">192</a> 		<em class="jxr_comment">//similarly lgpl includes server framework poms.  ignore</em>
<a class="jxr_linenumber" name="193" href="#193">193</a> 		<strong class="jxr_keyword">if</strong> (license != LGPL) {
<a class="jxr_linenumber" name="194" href="#194">194</a> 			pomIncludes.add(POM_SERVER);
<a class="jxr_linenumber" name="195" href="#195">195</a> 		}
<a class="jxr_linenumber" name="196" href="#196">196</a> 
<a class="jxr_linenumber" name="197" href="#197">197</a> 		<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="198" href="#198">198</a> <em class="jxr_comment">		 * Map the relevant sdk resources to their paths as they should be when extracted.</em>
<a class="jxr_linenumber" name="199" href="#199">199</a> <em class="jxr_comment">		 * Note that some resources are renamed to provide clarity, facilitate POM matching,</em>
<a class="jxr_linenumber" name="200" href="#200">200</a> <em class="jxr_comment">		 * and/or adhere to conventions.   </em>
<a class="jxr_linenumber" name="201" href="#201">201</a> <em class="jxr_comment">		 */</em>
<a class="jxr_linenumber" name="202" href="#202">202</a> 		distribution
<a class="jxr_linenumber" name="203" href="#203">203</a> 			.contents(<span class="jxr_string">"pom"</span>, Joiner.on(<span class="jxr_string">","</span>).join(pomIncludes), <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="204" href="#204">204</a> 			.contents(<span class="jxr_string">"doc/user"</span>, DOC_INCLUDES, DOC_EXCLUDES)
<a class="jxr_linenumber" name="205" href="#205">205</a> 			.contents(<span class="jxr_string">"doc/api/client/#javadoc"</span>, SMARTGWT_CLIENT_JAVADOC, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="206" href="#206">206</a> 			.contents(<span class="jxr_string">"doc/api/server/#javadoc"</span>, product == SMARTGWT ? SMARTGWT_SERVER_JAVADOC : SMARTCLIENT_JAVADOC, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="207" href="#207">207</a> 			.contents(<span class="jxr_string">"lib"</span>, JAR_INCLUDES, JAR_EXCLUDES + <span class="jxr_string">", "</span> + JAR_CONFLICTS)
<a class="jxr_linenumber" name="208" href="#208">208</a> 			.contents(<span class="jxr_string">"lib/isc-jakarta-oro.jar"</span>, <span class="jxr_string">"**/isc-jakarta-oro*.jar"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="209" href="#209">209</a> 			.contents(<span class="jxr_string">"lib/smartgwt-analytics.jar"</span>, <span class="jxr_string">"**/analytics.jar"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="210" href="#210">210</a> 			.contents(<span class="jxr_string">"lib/smartgwt-messaging.jar"</span>, <span class="jxr_string">"**/messaging.jar"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="211" href="#211">211</a> 			.contents(<span class="jxr_string">"lib/isomorphic-messaging.jar"</span>, <span class="jxr_string">"**/isomorphic_realtime_messaging.jar"</span>, <strong class="jxr_keyword">null</strong>)
<a class="jxr_linenumber" name="212" href="#212">212</a> 			.contents(<span class="jxr_string">"assembly/isc-selenium-resources"</span>, SELENIUM_INCLUDES, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="213" href="#213">213</a> 
<a class="jxr_linenumber" name="214" href="#214">214</a> 		<strong class="jxr_keyword">if</strong> (license == EVAL || license == POWER || license == ENTERPRISE) {
<a class="jxr_linenumber" name="215" href="#215">215</a> 			distribution.contents(<span class="jxr_string">"assembly/isc-batchuploader-resources/ds"</span>, <span class="jxr_string">"**/batchUpload.ds.xml"</span>, <strong class="jxr_keyword">null</strong>);
<a class="jxr_linenumber" name="216" href="#216">216</a> 		}
<a class="jxr_linenumber" name="217" href="#217">217</a> 		
<a class="jxr_linenumber" name="218" href="#218">218</a> 		DISTRIBUTIONS.put(product, license, distribution);
<a class="jxr_linenumber" name="219" href="#219">219</a> 		<strong class="jxr_keyword">return</strong> distribution;
<a class="jxr_linenumber" name="220" href="#220">220</a> 	}
<a class="jxr_linenumber" name="221" href="#221">221</a> 	
<a class="jxr_linenumber" name="222" href="#222">222</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="223" href="#223">223</a> <em class="jxr_javadoccomment">	 * Returns a fully-prepared Distribution instance representing an Isomorphic build, suitable for invoking download or repackaging </em>
<a class="jxr_linenumber" name="224" href="#224">224</a> <em class="jxr_javadoccomment">	 * operations against SDK bundles and their contents.</em>
<a class="jxr_linenumber" name="225" href="#225">225</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="226" href="#226">226</a> <em class="jxr_javadoccomment">	 * @param product The propduct for which a distribution exists and has been previously configured</em>
<a class="jxr_linenumber" name="227" href="#227">227</a> <em class="jxr_javadoccomment">	 * @param license The license under which the product is distributed and with which to execute some repackaing operation</em>
<a class="jxr_linenumber" name="228" href="#228">228</a> <em class="jxr_javadoccomment">	 * @return The fully-prepared Distribution instance, suitable for downloading and/or manipulating SDK bundles and their contents</em>
<a class="jxr_linenumber" name="229" href="#229">229</a> <em class="jxr_javadoccomment">	 * @throws IllegalArgumentException when no instance is found for the given Product, License combination</em>
<a class="jxr_linenumber" name="230" href="#230">230</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="231" href="#231">231</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">static</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> get(<a href="../../../../com/isomorphic/maven/packaging/Product.html">Product</a> product, <a href="../../../../com/isomorphic/maven/packaging/License.html">License</a> license) {
<a class="jxr_linenumber" name="232" href="#232">232</a> 		Distribution result = DISTRIBUTIONS.get(product, license);
<a class="jxr_linenumber" name="233" href="#233">233</a> 		<strong class="jxr_keyword">if</strong> (result == <strong class="jxr_keyword">null</strong>) {
<a class="jxr_linenumber" name="234" href="#234">234</a> 			<strong class="jxr_keyword">throw</strong> <strong class="jxr_keyword">new</strong> IllegalArgumentException(<span class="jxr_string">"Unknown distribution for product "</span> + product + <span class="jxr_string">" and license "</span> + license + <span class="jxr_string">"."</span>);
<a class="jxr_linenumber" name="235" href="#235">235</a> 		}
<a class="jxr_linenumber" name="236" href="#236">236</a> 		<em class="jxr_comment">//determine the location of the distribution by replacing url tokens with provided values </em>
<a class="jxr_linenumber" name="237" href="#237">237</a> 		<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="238" href="#238">238</a> <em class="jxr_comment">		String url = result.getRemoteIndex()</em>
<a class="jxr_linenumber" name="239" href="#239">239</a> <em class="jxr_comment">			.replaceAll("#product", product.toString())</em>
<a class="jxr_linenumber" name="240" href="#240">240</a> <em class="jxr_comment">			.replaceAll("#version", version)</em>
<a class="jxr_linenumber" name="241" href="#241">241</a> <em class="jxr_comment">			.replaceAll("#license", license.toString())</em>
<a class="jxr_linenumber" name="242" href="#242">242</a> <em class="jxr_comment">			.replaceAll("#date", date);</em>
<a class="jxr_linenumber" name="243" href="#243">243</a> 
<a class="jxr_linenumber" name="244" href="#244">244</a> <em class="jxr_comment">		result.setRemoteIndex(url);</em>
<a class="jxr_linenumber" name="245" href="#245">245</a> <em class="jxr_comment">		*/</em>
<a class="jxr_linenumber" name="246" href="#246">246</a> 		
<a class="jxr_linenumber" name="247" href="#247">247</a> 		<strong class="jxr_keyword">return</strong> result;
<a class="jxr_linenumber" name="248" href="#248">248</a> 	}	
<a class="jxr_linenumber" name="249" href="#249">249</a> 
<a class="jxr_linenumber" name="250" href="#250">250</a>     <a href="../../../../com/isomorphic/maven/packaging/Product.html">Product</a> product;
<a class="jxr_linenumber" name="251" href="#251">251</a>     <a href="../../../../com/isomorphic/maven/packaging/License.html">License</a> license;
<a class="jxr_linenumber" name="252" href="#252">252</a> 	
<a class="jxr_linenumber" name="253" href="#253">253</a>     <em class="jxr_comment">//a string representing a relative url from which a given distribution may be downloaded </em>
<a class="jxr_linenumber" name="254" href="#254">254</a> 	<strong class="jxr_keyword">private</strong> String remoteIndex = <span class="jxr_string">"/builds/#product/#version/#license/#date"</span>;	
<a class="jxr_linenumber" name="255" href="#255">255</a> 	<strong class="jxr_keyword">private</strong> List&lt;String&gt; selectors = <strong class="jxr_keyword">new</strong> ArrayList&lt;String&gt;();
<a class="jxr_linenumber" name="256" href="#256">256</a> 	<strong class="jxr_keyword">private</strong> Map&lt;String, AntPathMatcherFilter&gt; content = <strong class="jxr_keyword">new</strong> HashMap&lt;String, AntPathMatcherFilter&gt;();
<a class="jxr_linenumber" name="257" href="#257">257</a> 	<strong class="jxr_keyword">private</strong> Set&lt;File&gt; files = <strong class="jxr_keyword">new</strong> HashSet&lt;File&gt;();
<a class="jxr_linenumber" name="258" href="#258">258</a> 	
<a class="jxr_linenumber" name="259" href="#259">259</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="260" href="#260">260</a> <em class="jxr_javadoccomment">	 * Private constructor, in the singleton style.</em>
<a class="jxr_linenumber" name="261" href="#261">261</a> <em class="jxr_javadoccomment">	 * @param product </em>
<a class="jxr_linenumber" name="262" href="#262">262</a> <em class="jxr_javadoccomment">	 * @param license </em>
<a class="jxr_linenumber" name="263" href="#263">263</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="264" href="#264">264</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a>(<a href="../../../../com/isomorphic/maven/packaging/Product.html">Product</a> product, <a href="../../../../com/isomorphic/maven/packaging/License.html">License</a> license) {
<a class="jxr_linenumber" name="265" href="#265">265</a> 	    <strong class="jxr_keyword">this</strong>.product = product;
<a class="jxr_linenumber" name="266" href="#266">266</a> 	    <strong class="jxr_keyword">this</strong>.license = license;
<a class="jxr_linenumber" name="267" href="#267">267</a> 	}
<a class="jxr_linenumber" name="268" href="#268">268</a> 	
<a class="jxr_linenumber" name="269" href="#269">269</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="270" href="#270">270</a> <em class="jxr_javadoccomment">	 * Returns the set of files that were (at one time or another) downloaded from smartclient.com, usually compressed .zip or .jar files.  </em>
<a class="jxr_linenumber" name="271" href="#271">271</a> <em class="jxr_javadoccomment">	 * Note that the set is necessarily empty at initialization - Some index, local or remote, must first be interrogated to find a list of </em>
<a class="jxr_linenumber" name="272" href="#272">272</a> <em class="jxr_javadoccomment">	 * files matching {@link #include(String...) the patterns configured for this object}.  Any matched resources must then be resolved </em>
<a class="jxr_linenumber" name="273" href="#273">273</a> <em class="jxr_javadoccomment">	 * to local files before having their references added to this collection.</em>
<a class="jxr_linenumber" name="274" href="#274">274</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="275" href="#275">275</a> <em class="jxr_javadoccomment">	 * &lt;ul&gt;</em>
<a class="jxr_linenumber" name="276" href="#276">276</a> <em class="jxr_javadoccomment">	 * 	&lt;li&gt;SmartClient_AnalyticsModule-2014-01-01.zip&lt;/li&gt;</em>
<a class="jxr_linenumber" name="277" href="#277">277</a> <em class="jxr_javadoccomment">	 * 	&lt;li&gt;SmartClient_DrawingModule-2014-01-01.zip&lt;/li&gt;</em>
<a class="jxr_linenumber" name="278" href="#278">278</a> <em class="jxr_javadoccomment">	 * &lt;/ul&gt;</em>
<a class="jxr_linenumber" name="279" href="#279">279</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="280" href="#280">280</a> <em class="jxr_javadoccomment">	 * @return the Set of files making up the distribution.</em>
<a class="jxr_linenumber" name="281" href="#281">281</a> <em class="jxr_javadoccomment">	 * @see Downloads</em>
<a class="jxr_linenumber" name="282" href="#282">282</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="283" href="#283">283</a> 	<strong class="jxr_keyword">public</strong> Set&lt;File&gt; getFiles() {
<a class="jxr_linenumber" name="284" href="#284">284</a> 		<strong class="jxr_keyword">return</strong> files;
<a class="jxr_linenumber" name="285" href="#285">285</a> 	}
<a class="jxr_linenumber" name="286" href="#286">286</a> 	
<a class="jxr_linenumber" name="287" href="#287">287</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="288" href="#288">288</a> <em class="jxr_javadoccomment">	 * Adds an entry to the map of patterns used to determine which resources should be extracted from this distribution's collection of file/s.      </em>
<a class="jxr_linenumber" name="289" href="#289">289</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="290" href="#290">290</a> <em class="jxr_javadoccomment">	 * @param key A path to be used with any resource(s) that match the patterns provided.  Usually denotes a directory, but it can be used to specify a filename in cases where renaming is desirable.</em>
<a class="jxr_linenumber" name="291" href="#291">291</a> <em class="jxr_javadoccomment">	 * @param includes A comma-separated list of Ant-style patterns to be used to determine whether a given resource should be included in extraction / repackaging operations.</em>
<a class="jxr_linenumber" name="292" href="#292">292</a> <em class="jxr_javadoccomment">	 * @param excludes A comma-separated list of Ant-style patterns to be used to determine whether a given resource should be excluded from extraction / repackaging operations.</em>
<a class="jxr_linenumber" name="293" href="#293">293</a> <em class="jxr_javadoccomment">	 * @return This object, in 'fluid interface' style</em>
<a class="jxr_linenumber" name="294" href="#294">294</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="295" href="#295">295</a> <em class="jxr_javadoccomment">	 * @see AntPathMatcherFilter</em>
<a class="jxr_linenumber" name="296" href="#296">296</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="297" href="#297">297</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> contents(String key, String includes, String excludes) {
<a class="jxr_linenumber" name="298" href="#298">298</a> 		content.put(key, <strong class="jxr_keyword">new</strong> <a href="../../../../com/isomorphic/maven/util/AntPathMatcherFilter.html">AntPathMatcherFilter</a>(includes, excludes));
<a class="jxr_linenumber" name="299" href="#299">299</a> 		<strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">this</strong>;
<a class="jxr_linenumber" name="300" href="#300">300</a> 	}
<a class="jxr_linenumber" name="301" href="#301">301</a> 	
<a class="jxr_linenumber" name="302" href="#302">302</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="303" href="#303">303</a> <em class="jxr_javadoccomment">	 * Sets entries to the collection of regular expressions used to determine which hyperlinks should be used to download files from smartclient.com,</em>
<a class="jxr_linenumber" name="304" href="#304">304</a> <em class="jxr_javadoccomment">	 * clearing any expressions provided previously.</em>
<a class="jxr_linenumber" name="305" href="#305">305</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="306" href="#306">306</a> <em class="jxr_javadoccomment">	 * Each of the expressions provided is used to construct selection criteria used by an html parser.  Example:</em>
<a class="jxr_linenumber" name="307" href="#307">307</a> <em class="jxr_javadoccomment">	 * &lt;pre&gt;</em>
<a class="jxr_linenumber" name="308" href="#308">308</a> <em class="jxr_javadoccomment">	 *  	include("smartgwt-.*&#92;&#92;.zip");</em>
<a class="jxr_linenumber" name="309" href="#309">309</a> <em class="jxr_javadoccomment">	 * &lt;/pre&gt; </em>
<a class="jxr_linenumber" name="310" href="#310">310</a> <em class="jxr_javadoccomment">	 * yields an expression like</em>
<a class="jxr_linenumber" name="311" href="#311">311</a> <em class="jxr_javadoccomment">	 * &lt;pre&gt;</em>
<a class="jxr_linenumber" name="312" href="#312">312</a> <em class="jxr_javadoccomment">	 * 		a[href~=smartgwt-.*\.zip]</em>
<a class="jxr_linenumber" name="313" href="#313">313</a> <em class="jxr_javadoccomment">	 * &lt;/pre&gt;</em>
<a class="jxr_linenumber" name="314" href="#314">314</a> <em class="jxr_javadoccomment">	 * which will match links like the following:</em>
<a class="jxr_linenumber" name="315" href="#315">315</a> <em class="jxr_javadoccomment">	 * &lt;pre&gt;</em>
<a class="jxr_linenumber" name="316" href="#316">316</a> <em class="jxr_javadoccomment">	 * 		&amp;lt;a href="/builds/SmartGWT/4.0p/LGPL/2014-01-08/smartgwt-4.0p.zip"&amp;gt;smartgwt-4.0p.zip&amp;lt;/a&amp;gt;</em>
<a class="jxr_linenumber" name="317" href="#317">317</a> <em class="jxr_javadoccomment">	 * &lt;/pre&gt;</em>
<a class="jxr_linenumber" name="318" href="#318">318</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="319" href="#319">319</a> <em class="jxr_javadoccomment">	 * @param links The regular expressions used to determine which hyperlinks should be used to download files from smartclient.com</em>
<a class="jxr_linenumber" name="320" href="#320">320</a> <em class="jxr_javadoccomment">	 * @return This object, in 'fluid interface' style</em>
<a class="jxr_linenumber" name="321" href="#321">321</a> <em class="jxr_javadoccomment">	 * @see <a href="http://jsoup.org/cookbook/extracting-data/selector-syntax" target="alexandria_uri">http://jsoup.org/cookbook/extracting-data/selector-syntax</a></em>
<a class="jxr_linenumber" name="322" href="#322">322</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="323" href="#323">323</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> include(String... links) {
<a class="jxr_linenumber" name="324" href="#324">324</a> 		selectors.clear();
<a class="jxr_linenumber" name="325" href="#325">325</a> 		<strong class="jxr_keyword">for</strong> (String pattern : links) {
<a class="jxr_linenumber" name="326" href="#326">326</a> 			selectors.add(<span class="jxr_string">"a[href~="</span> + pattern + <span class="jxr_string">"]"</span>);
<a class="jxr_linenumber" name="327" href="#327">327</a> 		}
<a class="jxr_linenumber" name="328" href="#328">328</a> 		<strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">this</strong>;
<a class="jxr_linenumber" name="329" href="#329">329</a> 	}
<a class="jxr_linenumber" name="330" href="#330">330</a> 	
<a class="jxr_linenumber" name="331" href="#331">331</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="332" href="#332">332</a> <em class="jxr_javadoccomment">	 * Performs token replacement on the URL template representing the location of the distribution's "remote index", or download page.</em>
<a class="jxr_linenumber" name="333" href="#333">333</a> <em class="jxr_javadoccomment">	 * Useful at initialization in the case where some product/license combination uses an unconventional URL.</em>
<a class="jxr_linenumber" name="334" href="#334">334</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="335" href="#335">335</a> <em class="jxr_javadoccomment">	 * @param key the Key, including token, needing replacement.  e.g., #license</em>
<a class="jxr_linenumber" name="336" href="#336">336</a> <em class="jxr_javadoccomment">	 * @param replacement the value to use in the substitution.  e.g., EnterpriseEval</em>
<a class="jxr_linenumber" name="337" href="#337">337</a> <em class="jxr_javadoccomment">	 * @return This object, in 'fluid interface' style</em>
<a class="jxr_linenumber" name="338" href="#338">338</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="339" href="#339">339</a> 	<strong class="jxr_keyword">private</strong> <a href="../../../../com/isomorphic/maven/packaging/Distribution.html">Distribution</a> index(String key, String replacement) {
<a class="jxr_linenumber" name="340" href="#340">340</a> 		remoteIndex = remoteIndex.replaceAll(key, replacement);
<a class="jxr_linenumber" name="341" href="#341">341</a> 		<strong class="jxr_keyword">return</strong> <strong class="jxr_keyword">this</strong>;
<a class="jxr_linenumber" name="342" href="#342">342</a> 	}
<a class="jxr_linenumber" name="343" href="#343">343</a> 
<a class="jxr_linenumber" name="344" href="#344">344</a> 	<em class="jxr_javadoccomment">/**</em><em class="jxr_javadoccomment"> </em>
<a class="jxr_linenumber" name="345" href="#345">345</a> <em class="jxr_javadoccomment">	 * Returns the relative URL representing the location of the distribution's "remote index", or download page.  e.g.,</em>
<a class="jxr_linenumber" name="346" href="#346">346</a> <em class="jxr_javadoccomment">	 * &lt;p&gt;</em>
<a class="jxr_linenumber" name="347" href="#347">347</a> <em class="jxr_javadoccomment">	 * /builds/SmartGWT/4.1d/EnterpriseEval/2014-01-01</em>
<a class="jxr_linenumber" name="348" href="#348">348</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="349" href="#349">349</a> <em class="jxr_javadoccomment">	 * @param buildNumber</em>
<a class="jxr_linenumber" name="350" href="#350">350</a> <em class="jxr_javadoccomment">	 * @param buildDate</em>
<a class="jxr_linenumber" name="351" href="#351">351</a> <em class="jxr_javadoccomment">	 * @return the URL representing the location of the distribution's "remote index", or download page.</em>
<a class="jxr_linenumber" name="352" href="#352">352</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="353" href="#353">353</a> 	<strong class="jxr_keyword">protected</strong> String getRemoteIndex(String buildNumber, String buildDate) {
<a class="jxr_linenumber" name="354" href="#354">354</a> 	    
<a class="jxr_linenumber" name="355" href="#355">355</a> 	    <strong class="jxr_keyword">return</strong> remoteIndex
<a class="jxr_linenumber" name="356" href="#356">356</a> 	        .replaceAll(<span class="jxr_string">"#product"</span>, product.toString())
<a class="jxr_linenumber" name="357" href="#357">357</a> 	        .replaceAll(<span class="jxr_string">"#version"</span>, StringUtils.defaultString(buildNumber))
<a class="jxr_linenumber" name="358" href="#358">358</a> 	        .replaceAll(<span class="jxr_string">"#license"</span>, license.toString())
<a class="jxr_linenumber" name="359" href="#359">359</a> 	        .replaceAll(<span class="jxr_string">"#date"</span>, StringUtils.defaultString(buildDate));
<a class="jxr_linenumber" name="360" href="#360">360</a> 	}	
<a class="jxr_linenumber" name="361" href="#361">361</a> 	
<a class="jxr_linenumber" name="362" href="#362">362</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="363" href="#363">363</a> <em class="jxr_javadoccomment">	 * Returns a comma-separated list of all the {@link #selectors} that should be used to determine which </em>
<a class="jxr_linenumber" name="364" href="#364">364</a> <em class="jxr_javadoccomment">	 * 		   hyperlinks should be used to download files from smartclient.com.</em>
<a class="jxr_linenumber" name="365" href="#365">365</a> <em class="jxr_javadoccomment">	 * @return a comma-separated list of all the {@link #selectors} that should be used to determine which </em>
<a class="jxr_linenumber" name="366" href="#366">366</a> <em class="jxr_javadoccomment">	 * 		   hyperlinks should be used to download files from smartclient.com</em>
<a class="jxr_linenumber" name="367" href="#367">367</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="368" href="#368">368</a> 	<strong class="jxr_keyword">protected</strong> String getRemoteIndexFilter() {
<a class="jxr_linenumber" name="369" href="#369">369</a> 		<strong class="jxr_keyword">return</strong> Joiner.on(<span class="jxr_string">","</span>).join(selectors);
<a class="jxr_linenumber" name="370" href="#370">370</a> 	}
<a class="jxr_linenumber" name="371" href="#371">371</a> 
<a class="jxr_linenumber" name="372" href="#372">372</a> 	<em class="jxr_javadoccomment">/**</em>
<a class="jxr_linenumber" name="373" href="#373">373</a> <em class="jxr_javadoccomment">	 * Extract the relevant contents from each file in the distribution.  Additionally creates ZIP/JAR</em>
<a class="jxr_linenumber" name="374" href="#374">374</a> <em class="jxr_javadoccomment">	 * files from specified resources (e.g., javadoc).</em>
<a class="jxr_linenumber" name="375" href="#375">375</a> <em class="jxr_javadoccomment">	 * </em>
<a class="jxr_linenumber" name="376" href="#376">376</a> <em class="jxr_javadoccomment">	 * @param to The directory to which each file should be extracted.</em>
<a class="jxr_linenumber" name="377" href="#377">377</a> <em class="jxr_javadoccomment">	 * @throws IOException on any IOException during unzip operations</em>
<a class="jxr_linenumber" name="378" href="#378">378</a> <em class="jxr_javadoccomment">	 */</em>
<a class="jxr_linenumber" name="379" href="#379">379</a> 	<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">void</strong> unpack(File to) <strong class="jxr_keyword">throws</strong> IOException {
<a class="jxr_linenumber" name="380" href="#380">380</a> 		
<a class="jxr_linenumber" name="381" href="#381">381</a> 		<strong class="jxr_keyword">outer</strong>:
<a class="jxr_linenumber" name="382" href="#382">382</a> 		<strong class="jxr_keyword">for</strong> (File file : files) {
<a class="jxr_linenumber" name="383" href="#383">383</a> 			
<a class="jxr_linenumber" name="384" href="#384">384</a> 			String ext = FilenameUtils.getExtension(file.getName()).toUpperCase();
<a class="jxr_linenumber" name="385" href="#385">385</a> 			
<a class="jxr_linenumber" name="386" href="#386">386</a> 			<em class="jxr_comment">//copy uncompressed files to target, renaming as necessary per 'contents' configuration</em>
<a class="jxr_linenumber" name="387" href="#387">387</a> 			<strong class="jxr_keyword">if</strong> (! <span class="jxr_string">"ZIP"</span>.equals(ext)) {
<a class="jxr_linenumber" name="388" href="#388">388</a> 				<strong class="jxr_keyword">for</strong>(Map.Entry&lt;String, AntPathMatcherFilter&gt; filterEntry : content.entrySet()) {
<a class="jxr_linenumber" name="389" href="#389">389</a> 					AntPathMatcherFilter filter = filterEntry.getValue();
<a class="jxr_linenumber" name="390" href="#390">390</a> 					<strong class="jxr_keyword">if</strong> (filter.accept(file.getName())) {
<a class="jxr_linenumber" name="391" href="#391">391</a> 						File target = FileUtils.getFile(to, ArchiveUtils.rewritePath(file.getName(), filterEntry.getKey()));
<a class="jxr_linenumber" name="392" href="#392">392</a> 						FileUtils.copyFile(file, target);
<a class="jxr_linenumber" name="393" href="#393">393</a> 						LOGGER.debug(<span class="jxr_string">"Copied file '{}' to file '{}'"</span>, file.getName(), target.getAbsolutePath());
<a class="jxr_linenumber" name="394" href="#394">394</a> 						<strong class="jxr_keyword">continue</strong> <strong class="jxr_keyword">outer</strong>;
<a class="jxr_linenumber" name="395" href="#395">395</a> 					}
<a class="jxr_linenumber" name="396" href="#396">396</a> 				}
<a class="jxr_linenumber" name="397" href="#397">397</a> 				FileUtils.copyFileToDirectory(file, <strong class="jxr_keyword">new</strong> File(to, <span class="jxr_string">"lib"</span>));
<a class="jxr_linenumber" name="398" href="#398">398</a> 				<strong class="jxr_keyword">continue</strong> <strong class="jxr_keyword">outer</strong>;
<a class="jxr_linenumber" name="399" href="#399">399</a> 			}
<a class="jxr_linenumber" name="400" href="#400">400</a> 
<a class="jxr_linenumber" name="401" href="#401">401</a> 			<em class="jxr_comment">//otherwise extract contents (again renaming / relocating contents as necessary)</em>
<a class="jxr_linenumber" name="402" href="#402">402</a> 			ZipFile zip = <strong class="jxr_keyword">new</strong> ZipFile(file);
<a class="jxr_linenumber" name="403" href="#403">403</a> 			Enumeration&lt;? <strong class="jxr_keyword">extends</strong> ZipEntry&gt; entries = zip.entries();
<a class="jxr_linenumber" name="404" href="#404">404</a> 			
<a class="jxr_linenumber" name="405" href="#405">405</a> 			<strong class="jxr_keyword">while</strong> (entries.hasMoreElements()) {
<a class="jxr_linenumber" name="406" href="#406">406</a> 				ZipEntry entry = entries.nextElement();
<a class="jxr_linenumber" name="407" href="#407">407</a> 				<strong class="jxr_keyword">if</strong> (entry.isDirectory()) {
<a class="jxr_linenumber" name="408" href="#408">408</a> 					<strong class="jxr_keyword">continue</strong>;
<a class="jxr_linenumber" name="409" href="#409">409</a> 				}
<a class="jxr_linenumber" name="410" href="#410">410</a> 				<strong class="jxr_keyword">for</strong>(Map.Entry&lt;String, AntPathMatcherFilter&gt; filterEntry : content.entrySet()) {
<a class="jxr_linenumber" name="411" href="#411">411</a> 					AntPathMatcherFilter filter = filterEntry.getValue();
<a class="jxr_linenumber" name="412" href="#412">412</a> 					<strong class="jxr_keyword">if</strong> (filter.accept(entry.getName())) {
<a class="jxr_linenumber" name="413" href="#413">413</a> 						File target = FileUtils.getFile(to, ArchiveUtils.rewritePath(entry.getName(), filterEntry.getKey()));
<a class="jxr_linenumber" name="414" href="#414">414</a> 						FileUtils.copyInputStreamToFile(zip.getInputStream(entry), target);
<a class="jxr_linenumber" name="415" href="#415">415</a> 						LOGGER.debug(<span class="jxr_string">"Copied input stream to file '{}'"</span>, target.getAbsolutePath());
<a class="jxr_linenumber" name="416" href="#416">416</a> 					}	
<a class="jxr_linenumber" name="417" href="#417">417</a> 				}
<a class="jxr_linenumber" name="418" href="#418">418</a> 			}
<a class="jxr_linenumber" name="419" href="#419">419</a> 			zip.close();
<a class="jxr_linenumber" name="420" href="#420">420</a> 		}
<a class="jxr_linenumber" name="421" href="#421">421</a> 	
<a class="jxr_linenumber" name="422" href="#422">422</a> 		<em class="jxr_comment">/*</em>
<a class="jxr_linenumber" name="423" href="#423">423</a> <em class="jxr_comment">		 * Create any number of assemblies by dropping their resources here.</em>
<a class="jxr_linenumber" name="424" href="#424">424</a> <em class="jxr_comment">		 * Each subdirectory will get zipped up and then deleted</em>
<a class="jxr_linenumber" name="425" href="#425">425</a> <em class="jxr_comment">		 */</em>
<a class="jxr_linenumber" name="426" href="#426">426</a> 		File assembliesDir = <strong class="jxr_keyword">new</strong> File(to, <span class="jxr_string">"assembly"</span>);
<a class="jxr_linenumber" name="427" href="#427">427</a> 	
<a class="jxr_linenumber" name="428" href="#428">428</a> 		@SuppressWarnings(<span class="jxr_string">"unchecked"</span>)
<a class="jxr_linenumber" name="429" href="#429">429</a> 		Collection&lt;File&gt; assemblies = CollectionUtils.arrayToList(assembliesDir.listFiles(<strong class="jxr_keyword">new</strong> FileFilter() {
<a class="jxr_linenumber" name="430" href="#430">430</a> 			@Override
<a class="jxr_linenumber" name="431" href="#431">431</a> 			<strong class="jxr_keyword">public</strong> <strong class="jxr_keyword">boolean</strong> accept(File arg0) {
<a class="jxr_linenumber" name="432" href="#432">432</a> 				<strong class="jxr_keyword">return</strong> arg0.isDirectory();
<a class="jxr_linenumber" name="433" href="#433">433</a> 			}
<a class="jxr_linenumber" name="434" href="#434">434</a> 		}));
<a class="jxr_linenumber" name="435" href="#435">435</a> 		<strong class="jxr_keyword">for</strong> (File assembly : assemblies) {
<a class="jxr_linenumber" name="436" href="#436">436</a> 			String name = FilenameUtils.getBaseName(assembly.getName());
<a class="jxr_linenumber" name="437" href="#437">437</a> 			LOGGER.debug(<span class="jxr_string">"Copying resources for assembly '{}'"</span>, name);
<a class="jxr_linenumber" name="438" href="#438">438</a> 			ArchiveUtils.zip(assembly, FileUtils.getFile(assembliesDir, name + <span class="jxr_string">".zip"</span>));
<a class="jxr_linenumber" name="439" href="#439">439</a> 			FileUtils.deleteQuietly(assembly);
<a class="jxr_linenumber" name="440" href="#440">440</a> 		}
<a class="jxr_linenumber" name="441" href="#441">441</a> 
<a class="jxr_linenumber" name="442" href="#442">442</a> 		LOGGER.debug(<span class="jxr_string">"Repackaging Javadoc..."</span>);
<a class="jxr_linenumber" name="443" href="#443">443</a> 		File docLib = <strong class="jxr_keyword">new</strong> File(to, <span class="jxr_string">"doc/lib"</span>);
<a class="jxr_linenumber" name="444" href="#444">444</a> 		
<a class="jxr_linenumber" name="445" href="#445">445</a> 		<em class="jxr_comment">//TODO these paths should probably all be stuck in some constant</em>
<a class="jxr_linenumber" name="446" href="#446">446</a> 		File client = FileUtils.getFile(to, <span class="jxr_string">"doc/api/client"</span>);
<a class="jxr_linenumber" name="447" href="#447">447</a> 		<strong class="jxr_keyword">if</strong> (client.exists()) {
<a class="jxr_linenumber" name="448" href="#448">448</a> 			ArchiveUtils.jar(client, <strong class="jxr_keyword">new</strong> File(docLib, <span class="jxr_string">"smartgwt-javadoc.jar"</span>));	
<a class="jxr_linenumber" name="449" href="#449">449</a> 		}
<a class="jxr_linenumber" name="450" href="#450">450</a> 		
<a class="jxr_linenumber" name="451" href="#451">451</a> 		File server = FileUtils.getFile(to, <span class="jxr_string">"doc/api/server"</span>);
<a class="jxr_linenumber" name="452" href="#452">452</a> 		<strong class="jxr_keyword">if</strong> (server.exists()) {
<a class="jxr_linenumber" name="453" href="#453">453</a> 			ArchiveUtils.jar(server, <strong class="jxr_keyword">new</strong> File(docLib, <span class="jxr_string">"isomorphic-javadoc.jar"</span>));	
<a class="jxr_linenumber" name="454" href="#454">454</a> 		}
<a class="jxr_linenumber" name="455" href="#455">455</a> 	}
<a class="jxr_linenumber" name="456" href="#456">456</a> 
<a class="jxr_linenumber" name="457" href="#457">457</a> }
</pre>
<hr/><div id="footer">This page was automatically generated by <a href="http://maven.apache.org/">Maven</a></div></body>
</html>

